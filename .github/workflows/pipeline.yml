name: VisitWithUs - End-to-End ML Pipeline
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:
jobs:
  ml_pipeline:
    runs-on: ubuntu-latest

    env:
      HF_DATASET_REPO: ddadid/visit-with-us-wellness-tourism
      HF_MODEL_REPO: ddadid/visit-with-us-wellness-tourism
      TRAIN_PATH_IN_DATASET: processed/train.csv
      TEST_PATH_IN_DATASET: processed/test.csv

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Data Preparation (load from HF Dataset)
        run: |
          python -m src.data_prep

      - name: Train + Hyperparameter Tuning
        run: |
          python -m src.train

      - name: Evaluate Model
        run: |
          python -m src.evaluate

      - name: Upload artifacts to GitHub Actions run
        uses: actions/upload-artifact@v4
        with:
          name: wellness-model-artifacts
          path: artifacts/

      - name: Push model + metrics to Hugging Face Model Hub
        if: github.ref == 'refs/heads/main'
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python -m src.push_to_hf
